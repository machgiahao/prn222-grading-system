{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },
  "AllowedHosts": "*",

  "JwtSettings": {
    "Key": "af12gx12h43jk6k5je./sdflisdhkajewu243j32jkhjk652jkbj4h5k",
    "Issuer": "https://localhost:7000",
    "Audience": "Prn222GradingSystem",
    "AccessTokenDurationInMinutes": 60,
    "RefreshTokenDurationInDays": 7
  },

  "ReverseProxy": {
    "Routes": {
        "identity-route": {
            "ClusterId": "identity-cluster",
            "Match": {
                "Path": "/api/v1/auth/{**catch-all}"
            }
        },

        "users-route": {
            "ClusterId": "identity-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/users/{**catch-all}"
            }
        },

        // Exam Service
        "subjects-route": {
            "ClusterId": "exam-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/subject/{**catch-all}"
            }
        },

        "semesters-route": {
            "ClusterId": "exam-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/semester/{**catch-all}"
            }
        },

        "rubrics-route": {
            "ClusterId": "exam-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/rubrics/{**catch-all}"
            }
        },

        "exams-route": {
            "ClusterId": "exam-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/exams/{**catch-all}"
            }
        },

        // Grading Service
        "submissions-route": {
            "ClusterId": "grading-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/submissions/{**catch-all}"
            }
        },

        "submissions-upload-route": {
          "ClusterId": "grading-cluster",
          "AuthorizationPolicy": "authenticated",
          "RateLimiterPolicy": "upload",
          "Match": {
            "Path": "/api/v1/submissions/upload"
          },
          "Metadata": {
            "Timeout": "00:10:00"
          }
        },

        "grades-route": {
            "ClusterId": "grading-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/grades/{**catch-all}"
            }
        },
        "reports-route": {
            "ClusterId": "grading-cluster",
            "AuthorizationPolicy": "authenticated",
            "RateLimiterPolicy": "api",
            "Match": {
                "Path": "/api/v1/reports/{**catch-all}"
            }
        },
        "grading-signalr": {
            "ClusterId": "grading-cluster",
            "Match": {
                "Path": "/hubs/upload-progress/{**catch-all}"
            },
            "Transforms": [
                {
                    "RequestHeader": "X-Forwarded-For",
                    "Append": "{RemoteIpAddress}"
                }
            ]
        }
    },

    "Clusters": {
      "identity-cluster": {
        "Destinations": {
          "identity-api": {
            "Address": "https://localhost:7000"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "exam-cluster": {
        "Destinations": {
          "exam-api": {
            "Address": "https://localhost:7001"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },

      "grading-cluster": {
        "Destinations": {
          "grading-api": {
            "Address": "https://localhost:7002"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        },
        "HttpRequest": {
          "Timeout": "00:10:00" 
        }
      }
    }
  }
}
